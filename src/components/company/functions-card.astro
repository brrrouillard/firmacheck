---
/**
 * Functions Card - Display company directors and managers
 */

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Users } from 'lucide-react';
import { t } from '@/lib/i18n/translations';
import type { SupportedLang } from '@/lib/i18n/translations';
import type { CompanyFunction } from '@/lib/db/types';

interface Props {
  functions: CompanyFunction[] | null;
  lang: string;
}

const { functions, lang } = Astro.props;
const typedLang = (lang === 'nl' ? 'nl' : lang === 'en' ? 'en' : 'fr') as SupportedLang;

// Format date for display
const formatDate = (dateStr: string | null) => {
  if (!dateStr) return null;
  const date = new Date(dateStr);
  const locale = typedLang === 'nl' ? 'nl-BE' : typedLang === 'en' ? 'en-GB' : 'fr-BE';
  return date.toLocaleDateString(locale, { year: 'numeric', month: 'long', day: 'numeric' });
};

// Translate role code to display text
const translateRole = (roleCode: string, rawRole: string): string => {
  // Use translation if available, otherwise use raw role
  const translated = t(typedLang, 'functions', roleCode);
  return translated !== roleCode ? translated : rawRole;
};

// Only render if we have functions
const hasFunctions = functions && functions.length > 0;
---

{hasFunctions && (
  <Card>
    <CardHeader className="pb-3">
      <div class="flex items-center gap-2">
        <Users className="h-5 w-5 text-muted-foreground" />
        <CardTitle className="text-base font-medium">
          {t(typedLang, 'functions', 'title')}
        </CardTitle>
      </div>
    </CardHeader>
    <CardContent>
      <ul class="space-y-3">
        {functions!.map((func) => (
          <li class="flex items-start justify-between gap-4">
            <div>
              <p class="font-medium text-sm">{func.first_name} {func.last_name}</p>
              <p class="text-xs text-muted-foreground">
                {translateRole(func.role_code, func.role)}
              </p>
            </div>
            {func.start_date && (
              <p class="text-xs text-muted-foreground whitespace-nowrap">
                {`${t(typedLang, 'functions', 'since')} ${formatDate(func.start_date)}`}
              </p>
            )}
          </li>
        ))}
      </ul>
    </CardContent>
  </Card>
)}
