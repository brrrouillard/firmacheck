---
/**
 * Related Companies Section
 *
 * Displays two sections at the bottom of company pages:
 * 1. Similar companies (same NACE sector)
 * 2. Neighbor companies (same postal code)
 */

import { Building2, MapPin } from 'lucide-react';
import CompanyLinkCard from './company-link-card.astro';
import { t } from '@/lib/i18n/translations';
import type { SupportedLang } from '@/lib/i18n/translations';
import type { RelatedCompany } from '@/lib/queries/related-companies';

interface Props {
  similar: RelatedCompany[];
  neighbors: RelatedCompany[];
  sectorName: string | null;
  postalCode: string | null;
  cityName: string | null;
  lang: string;
}

const { similar, neighbors, sectorName, postalCode, cityName, lang } = Astro.props;
const typedLang = (lang === 'nl' ? 'nl' : lang === 'en' ? 'en' : 'fr') as SupportedLang;

const hasSimilar = similar.length > 0;
const hasNeighbors = neighbors.length > 0;

// Hide entire section if no data
if (!hasSimilar && !hasNeighbors) {
  return null;
}
---

<section>
  <div class="mx-auto max-w-5xl px-4 py-6 sm:px-6 lg:px-8 space-y-8">

    {/* Similar Companies Section */}
    {hasSimilar && (
      <div>
        <div class="flex items-center gap-2 mb-4">
          <Building2 className="h-5 w-5 text-muted-foreground shrink-0" />
          <h2 class="text-base font-semibold">
            {t(typedLang, 'related', 'similarIn')} {sectorName || t(typedLang, 'related', 'thisSector')}
          </h2>
        </div>
        <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
          {similar.map((company) => (
            <CompanyLinkCard company={company} lang={lang} />
          ))}
        </div>
      </div>
    )}

    {/* Neighbors Section */}
    {hasNeighbors && (
      <div>
        <div class="flex items-center gap-2 mb-4">
          <MapPin className="h-5 w-5 text-muted-foreground shrink-0" />
          <h2 class="text-base font-semibold">
            {t(typedLang, 'related', 'neighborsIn')} {postalCode} {cityName}
          </h2>
        </div>
        <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
          {neighbors.map((company) => (
            <CompanyLinkCard company={company} lang={lang} />
          ))}
        </div>
      </div>
    )}

  </div>
</section>
